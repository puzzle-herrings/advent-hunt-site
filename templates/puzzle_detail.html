{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  {% include "partials/timestamp_localize_libraries.html" %}
  <div class="row">
    <div class="col">
      <h1>{{ puzzle.name }}</h1>
    </div>
  </div>
  <div class="row mb-2">
    <div class="col"></div>
    <div class="col-sm-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Check answer</h5>
          <form hx-post="guess/" hx-target="#guesses-table">
            {% csrf_token %}
            <div class="input-group">
              {{ form.guess }}
              <button type="submit" class="btn btn-primary" id="submit-guess">Submit</button>
            </div>
          </form>
          <div id="guesses-table">
            {% if guesses %}
              {% include "partials/puzzle_guess_list.html" %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col"></div>
  </div>
  <div class="row">
    <div class="col">
      <style>
            .puzzle-pdf-frame {
                width: 100%;
                height: 100vh;
            }
      </style>
      <object data="{{ puzzle.pdf_url }}"
              type="application/pdf"
              class="puzzle-pdf-frame">
        <p>
          Something prevented us from displaying the puzzle! Click <a href="{{ puzzle.pdf_url }}">here</a> to download it instead.
        </p>
      </object>
    </div>
  </div>
  {% if user.is_tester %}
    <link href="{% static 'css/puzzle_detail_tester.css' %}" rel="stylesheet" />
    <div id="answer-cheatsheet-container">
      <div id="answer-cheatsheet">
        <p>
          Answer: <strong>{{ puzzle.answer }}</strong>
        </p>
        {% if puzzle.keep_going_answers %}
          <p>
            Keep Going: <strong>{{ puzzle.keep_going_answers|join:"</strong>, <strong>" }}</strong>
          </p>
        {% endif %}
      </div>
      <div>
        <button type="button"
                id="answer-cheatsheet-toggle"
                class="btn btn-warning btn-sm">Testing: Show Answer</button>
      </div>
    </div>
    <script>
      const button = document.getElementById("answer-cheatsheet-toggle");
      const cheatsheet = document.getElementById("answer-cheatsheet");
      cheatsheet.style.display = "none";

      button.addEventListener("click", () => {
        if (cheatsheet.style.display === "none") {
          cheatsheet.style.display = "block";
        } else {
          cheatsheet.style.display = "none";
        }
      });

      function copyToClipboard(elem) {
        // Copy the text inside the text field
        navigator.clipboard.writeText(elem.dataset.copy);
      }
    </script>
  {% endif %}
{% endblock content %}
