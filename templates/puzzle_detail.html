{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block body %}
  <section class="section no-bottom-padding">
    <div class="container has-text-centered">
      {% include "partials/messages.html" %}
      <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.9.12/htmx.min.js"
              integrity="sha512-JvpjarJlOl4sW26MnEb3IdSAcGdeTeOaAlu2gUZtfFrRgnChdzELOZKl0mN6ZvI0X+xiX5UMvxjK2Rx2z/fliw=="
              crossorigin="anonymous"
              referrerpolicy="no-referrer"></script>
      {% include "partials/timestamp_localize_libraries.html" %}
      <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
      <link href="{% static 'css/puzzle_detail.css' %}" rel="stylesheet" />
      <h1 class="title is-1 block">
        {{ puzzle.name }}
        {% if not puzzle.is_available %}<span class="tag is-danger">Preview</span>{% endif %}
      </h1>
      <div id="answer-checker" class="card is-toggleable block">
        <header class="card-header">
          <p class="card-header-title">Check&nbsp;answer</p>
          {% include "partials/card_toggle_indicator.html" %}
        </header>
        <div class="card-content">
          <div id="guess-form" class="block">{% crispy form %}</div>
          <div id="guesses-table" class="block">
            {% if guesses %}
              {% include "partials/puzzle_guess_list.html" %}
            {% endif %}
          </div>
        </div>
      </div>
      {% include "partials/card_toggle_script.html" %}
      <div class="is-flex help-container is-justify-content-space-between block">
        <p class="has-text-grey-light">
          <i class="bi bi-info-circle"></i>
          Scroll with cursor within PDF frame to scroll PDF. Scroll with cursor outside of frame to scroll webpage.
        </p>
        <p class="has-text-centered">
          <a class="button is-small"
             href="javascript: document.body.scrollIntoView(false);"
             data-tts
             aria-label="Jump to bottom">
            <span>&nbsp;<i class="bi bi-chevron-double-down"></i>&nbsp;</span>
          </a>
          <a class="button is-small"
             href="{{ puzzle.pdf_url }}"
             target="_blank"
             data-tts
             aria-label="Open PDF in new tab">
            <span>&nbsp;<i class="bi bi-box-arrow-up-right"></i>&nbsp;</span>
          </a>
          <a class="button is-small"
             href="{{ puzzle.pdf_url }}"
             download
             data-tts
             aria-label="Download PDF">
            <span>&nbsp;<i class="bi bi-download"></i>&nbsp;</span>
          </a>
        </p>
      </div>
      <div class="has-text-centered block">
        <object data="{{ puzzle.pdf_url }}"
                type="application/pdf"
                class="puzzle-pdf-frame">
          <p>
            Something prevented us from displaying the puzzle! Click <a href="{{ puzzle.pdf_url }}">here</a> to download it instead.
          </p>
        </object>
        <link href="https://cdn.jsdelivr.net/npm/@zkreations/tooltips@4/tooltips.min.css"
              rel="stylesheet" />
        {% if user.is_tester %}
          <link href="{% static 'css/puzzle_detail_tester.css' %}" rel="stylesheet" />
          <div id="answer-cheatsheet-container">
            <div id="answer-cheatsheet">
              <p>
                Answer: <strong>{{ puzzle.answer }}</strong>
              </p>
              {% if puzzle.keep_going_answers %}
                <p>
                  Keep Going: <strong>{{ puzzle.keep_going_answers|join:"</strong>, <strong>" }}</strong>
                </p>
              {% endif %}
            </div>
            <div>
              <button type="button" id="answer-cheatsheet-toggle" class="button is-danger">Testing: Show Answer</button>
            </div>
          </div>
          <script>
            const button = document.getElementById("answer-cheatsheet-toggle");
            const cheatsheet = document.getElementById("answer-cheatsheet");
            cheatsheet.style.display = "none";

            button.addEventListener("click", () => {
              if (cheatsheet.style.display === "none") {
                cheatsheet.style.display = "block";
              } else {
                cheatsheet.style.display = "none";
              }
            });
          </script>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock body %}
